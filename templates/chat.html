{% extends "base.html" %}
{% block head %}
<title>Chat Example</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
<script type="text/javascript" src='//code.jquery.com/jquery-1.4.2.min.js'></script>
<script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js'></script>
<script type="text/javascript">
    var socket;
    $(document).ready(function() {
        // getstrongwith.me
        socket = io.connect('http://' + document.domain + ':' + location.port + '/chat');
        //socket = io.connect('http://getstrongwith.me:5004/chat')

        socket.on('connect', function() {
            //io.socket.clients(room)
            socket.emit('join', {});
            console.log('socket connected');
        });
        socket.on('status', function(data) {
            $('#chat').val($('#chat').val() + '<' + data.msg + '>\n');
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
        socket.on('message', function(data) {
            $('#chat').val($('#chat').val() + data.msg + '\n');
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
        $('#send').click(function(e) {
                text = $('#text').val();
                $('#text').val('');
                socket.emit('text', {msg: text});
        });
    });

    function leave_room() {
        socket.emit('left', {}, function() {
            socket.disconnect();
            window.location.href = '{{url_for("index") }}';
        })
    }
</script>
{% endblock %}
{% block body %}

<!-- Navigation-->
<nav class="navbar navbar-expand navbar-dark bg-dark nav-top p-0">
    <div class="container">
       <a class="navbar-brand mr-2" href="/">GetStrongWith.me
       </a>
       <form class="d-none d-sm-inline-block form-inline mr-auto my-2 my-md-0 mw-100 navbar-search" action='/search' method="POST">
          <div class="navtop search"><i class="fa fa-search"></i>
             <input type="search" class="form-control shadow-none" placeholder="Search" aria-label="Search" name="search" aria-describedby="basic-addon2">
             
          </div>
       </form>
       <ul class="navbar-nav ml-auto d-flex align-items-center">
          <li class="nav-item dropdown no-arrow d-sm-none">
             <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <i class="feather-search mr-2"></i>
             </a>
             <div class="dropdown-menu dropdown-menu-right p-3 shadow-sm animated--grow-in" aria-labelledby="searchDropdown">
                <form class="form-inline mr-auto w-100 navbar-search">
                   <div class="input-group">
                      <input type="text" class="form-control border-0 shadow-none" placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                      <div class="input-group-append">
                         <button class="btn" type="button">
                         <i class="feather-search"></i>
                         </button>
                      </div>
                   </div>
                </form>
             </div>
          </li>
          <li class="nav-item dropdown no-arrow mx-1 list-dropdown">
             <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <i class="fa fa-inbox"></i>
             <span class="badge badge-danger badge-counter">1</span>
             </a>
             <div class="dropdown-list dropdown-menu dropdown-menu-right shadow-sm">
                <h6 class="dropdown-header">
                   Direct Messages
                </h6>
                <a class="dropdown-item d-flex align-items-center" href="/chat">
                   <div class="dropdown-list-image mr-3">
                      <img class="rounded-circle" src="img/p1.png" alt="">
                      <div class="status-indicator bg-success"></div>
                   </div>
                   <div class="font-weight-bold overflow-hidden">
                          {% for dm in dms %}
                          <div class="text-truncate"> {{ dm[1] }} </div>
                          <div class="small text-gray-500">{{ dm[0] }} Â· {{ dm[2] }} </div>
                          <div> ---------------------------- </div>
                          {% endfor %}
                       </div>
                </a>
                <a class="dropdown-item text-center small text-gray-500" href="/chat">Read More Messages</a>
             </div>
          </li>
          <li class="nav-item dropdown no-arrow mx-1 list-dropdown">
             <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <i class="fa fa-bell"></i>
             <span class="badge badge-info badge-counter">1</span>
             </a>
             <div class="dropdown-list dropdown-menu dropdown-menu-right shadow-sm">
  
                <h6 class="dropdown-header">
                   Notification Center
                </h6>
                <a class="dropdown-item d-flex align-items-center" href="notifications.html">
                   <div class="mr-3">
                      <div class="icon-circle bg-primary">
                         <i class="fa fa-bell"></i>
                      </div>
                   </div>
                   <div>
                      <div class="small text-gray-500">TIME_PLACEHOLDER</div>
                      <span class="font-weight-bold">Debug: This is home.html</span>
                   </div>
                </a>
                
                <a class="dropdown-item text-center small text-gray-500" href="notifications.html">Show All Alerts</a>
             </div>
          </li>
          <li class="nav-item dropdown no-arrow ml-1 profile-dropdown">
             <a class="nav-link dropdown-toggle pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <img class="img-profile rounded-circle" src="{{current_user.profile_pic}}">
             </a>
             <div class="dropdown-menu dropdown-menu-right shadow-sm">
                <div class="p-3 d-flex align-items-center">
                   <div class="dropdown-list-image mr-3">
                      <img class="img-profile rounded-circle" src="{{current_user.profile_pic}}" alt="">
                      <div class="status-indicator bg-success"></div>
                   </div>
                   <div class="font-weight-bold">
                      <div class="text-truncate">{{current_user.firstname}} {{current_user.lastname}}</div>
                      <div class="small text-gray-500">@{{current_user.username}}</div>
                   </div>
                </div>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="/home"><i class="feather-edit mr-1"></i>Home</a>
                <a class="dropdown-item" href="/my-account"><i class="feather-edit mr-1"></i> My Account</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="/logout"><i class="feather-log-out mr-1"></i> Logout</a>
             </div>
          </li>
       </ul>
    </div>
  </nav>
  <!-- end navigation-->

 
        <div class='chatwindow'>
            <h2 id='room'>Chatting with {{ session['recipient_name'] }}</h2><br>
            <textarea readonly id='chat' cols='70' rows='10' placeholder='No messages yet...'></textarea><br>
            <input type='text' id='text' size='60' placeholder='Enter message here'>
            <button type='button' id='send' class='btn btn-success'>SEND</button><br><br>
            <center> <button type='button' class='btn btn-danger' onclick=leave_room()>Leave Chat</button></center>
        </div>
    
 





{% endblock %}